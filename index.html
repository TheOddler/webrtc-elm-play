<html>
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Pablo's Spel</title>
	</head>
    <body>
        <div id="main">

		<script src="simplepeer.min.js"></script>
        <script src="main.js" type="text/javascript"></script>
        <script src="webrtcconnect.js" type="text/javascript"></script>
        <script type="text/javascript">
            // Create elm
            var app = Elm.Main.embed(document.getElementById('main'))

            // Login to parent (later signaling server) to see if you are initiator or not
            parent.postMessage({type: "login", data:"..."}, "*")

            var peer = null
            function initialize(initiator) { //called directly by parent when both players logged in
                // Create two simple peers and connect, for debugging on one page
                peer = new SimplePeer({ initiator: initiator, trickle: false }) // TODO
                peer.on('signal', function (data) {
                    parent.postMessage({type: "signal", data: data}, "*")
                })

                // Connect Elm and WebRTC
                var parent_ = parent
                peer.on('data', function (data) {
                    app.ports.listen.send("" + data)
                })
                app.ports.send.subscribe(function(message) {
                    peer.send(message)
                })
            }

            function signal(signal) { //called directly by parent
                peer.signal(signal)
            }
		</script>
    </body>
</html>