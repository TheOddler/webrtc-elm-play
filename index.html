<html>
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Pablo's Spel</title>
	</head>
    <body>
        <div id="main"></div>

		<script src="https://simplewebrtc.com/latest-v2.js"></script>
        <script src="main.js" type="text/javascript"></script>
        <script type="text/javascript">
            // Create elm
            var node = document.getElementById('main');
            var app = Elm.Main.embed(node);

            // Start WebRTC
            var webrtc = new SimpleWebRTC({
                localVideoEl: '', remoteVideosEl: '', // we don't do video
                autoRequestMedia: false, // dont ask for camera access
                receiveMedia: { offerToReceiveAudio: 0, offerToReceiveVideo: 0 } // dont negotiate media
            });
            webrtc.joinRoom('pablos mtg test room');

            webrtc.on('createdPeer', function (peer) {
                console.log('createdPeer', peer);
            });

            // Connect WebRTC and Elm
            app.ports.send.subscribe(function(message) {
                console.log('Sending: ');
                console.log(message);
                webrtc.sendDirectlyToAll("mtg", "elm-message", message)
            });
            
            webrtc.on('channelMessage', function (peer, label, data) {
                console.log('Got a message: ');
                console.log(data);
                if (data.type === "elm-message") {
                    app.ports.listen.send(data.payload);
                }
            });
		</script>
    </body>
</html>