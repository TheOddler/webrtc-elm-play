<html>
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Pablo's Spel</title>

		<link rel="stylesheet" type="text/css" href="css/styles.css">
	</head>
    <body>
        <h1>Pablo's WebRTC and Elm test</h1>
        <p>The Elm app is run twice, and connected using WebRTC on a single page. A bit silly for a real app, but great for debugging.</p>
        <div class="wrapper">
            <div class="container" id="main1">
            </div>
            <div class="container" id="main2">
            </div>
        </div>

		<script src="simplepeer.min.js"></script>
        <script src="main.js" type="text/javascript"></script>
        <script src="webrtcconnect.js" type="text/javascript"></script>
        <script type="text/javascript">
            // Create elm
            var app1 = Elm.Main.embed(document.getElementById('main1'))
            var app2 = Elm.Main.embed(document.getElementById('main2'))

            // Create two simple peers and connect, for debugging on one page
            var peer1 = new SimplePeer({ initiator: true, trickle: false })
            var peer2 = new SimplePeer({ initiator: false, trickle: false })
            peer1.on('signal', function (data) { peer2.signal(data) })
            peer2.on('signal', function (data) { peer1.signal(data) })

            // Connect Elm and WebRTC
            peer1.on('data', function (data) {
                app1.ports.listen.send("" + data)
            })
            peer2.on('data', function (data) {
                app2.ports.listen.send("" + data)
            })

            app1.ports.send.subscribe(function(message) {
                peer1.send(message)
            })
            app2.ports.send.subscribe(function(message) {
                peer2.send(message)
            })
		</script>
    </body>
</html>